apiVersion: kubeadm.k8s.io/v1beta2
kind: ClusterConfiguration
kubernetesVersion: stable
{%if k8s_ha_masters %}
controlPlaneEndpoint: {{k8s_loadbalancer_ip}}:6443
{%endif%}
networking:
  podSubnet: {{k8s_cni_pod_cidr}}
  serviceSubnet: {{k8s_service_cidr}}
  dnsDomain: cluster.local
apiServer:
  certSANs:
  - localhost
  - 127.0.0.1
  - {{lb_k8s_public_ip}}
  - {{lb_k8s_api_url}}
{%for node in groups['k8s-nodes'] %}
  - {{hostvars[node]['ansible_host']}}
  - {{hostvars[node]['inventory_hostname']}}
  - {{hostvars[node]['inventory_hostname']}}.{{hostvars[node]['domain']}}
{%endfor%}
{# {% if k8s_kubeadm_apiserver_address is defined %}
  extraArgs:
    advertise-address: {{k8s_kubeadm_apiserver_address}}
etcd:
    local:
        extraArgs:
            initial-cluster: ${NAMES[0]}=https://${ETCDHOSTS[0]}:2380,${NAMES[1]}=https://${ETCDHOSTS[1]}:2380,${NAMES[2]}=https://${ETCDHOSTS[2]}:2380
            initial-cluster-state: new
            listen-peer-urls: https://${HOST}:2380
            listen-client-urls: https://${HOST}:2379
            advertise-client-urls: https://${HOST}:2379
            initial-advertise-peer-urls: https://${HOST}:2380
{% endif %} #}