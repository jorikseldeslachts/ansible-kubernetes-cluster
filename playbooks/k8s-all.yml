- hosts: k8s-nodes
  tasks:
    - debug:
        msg: "Starting full Kubernetes cluster installation on nodes: {{item}}"
      with_items: 
        - groups['k8s-nodes']
      when: "inventory_hostname == groups['masters'][0]"
    
    - name: "Register main master that will be used to get all the info from"
      set_fact:
        main_master: groups['masters'][0]

    - debug: 
        msg: "Ready to start importing other playbooks. main-master: {{main_master}}"
      when: "inventory_hostname == groups['masters'][0]"

# - { import_playbook: cleanup-vms,  when: reinit_vms_completely |bool }
# - import_playbook: nginx-k8s-lb.yml

- import_playbook: prep-node-vms.yml
- import_playbook: ntpd.yml
- import_playbook: docker.yml
- import_playbook: firewalld.yml

- import_playbook: k8s-dependencies.yml
- import_playbook: k8s-init-masters.yml
- import_playbook: k8s-init-workers.yml

- import_playbook: k8s-label-nodes.yml
- { import_playbook: nginx-ingress-controller.yml, when: "inventory_hostname in groups['masters']" }
- import_playbook: k8s-cluster-info.yml
- import_playbook: cockpit.yml

# test
- { import_playbook: test-run.yml, when: deploy_test_app |bool }



